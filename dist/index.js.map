{"version":3,"sources":["../lib/index.ts","../lib/server.ts","../lib/types.ts","../lib/storage.ts","../lib/utils.ts","../lib/chain.ts","../lib/providers/solana.ts","../lib/webhook.ts","../lib/qrcode.ts","../lib/paylink-token.ts"],"sourcesContent":["// Main exports\nexport { PaylinkServer, createServer } from './server.js';\n\n// Types\nexport type {\n  PaylinkConfig,\n  PayLink,\n  Payment,\n  Price,\n  ChainConfig,\n  ChainType,\n  CreatePayLinkInput,\n  Storage,\n  PayLinkStatus,\n  PaymentStatus,\n  Protocol402Response,\n  Protocol403Response,\n  PaymentCheckResult,\n  WebhookConfigType,\n} from './types.js';\n\nexport { ReasonCode, SOLANA_CHAIN_IDS } from './types.js';\n\n// Storage\nexport { MemoryStorage } from './storage.js';\n\n// Chain verification\nexport { ChainVerifier, MockVerifier } from './chain.js';\n\n// Solana verification\nexport { SolanaVerifier, MockSolanaVerifier, createSolanaVerifier } from './providers/solana.js';\nexport type { SolanaConfig } from './providers/solana.js';\n\n// QR Code generation\nexport {\n  generatePaymentURI,\n  generateQRCodeSVG,\n  generateQRCodeDataURL,\n  generatePaymentQR,\n} from './qrcode.js';\nexport type { QRCodeOptions, PaymentQRData } from './qrcode.js';\n\n// Webhooks\nexport {\n  WebhookManager,\n  createWebhookManager,\n  verifyWebhookSignature,\n} from './webhook.js';\nexport type {\n  WebhookConfig,\n  WebhookEvent,\n  WebhookPayload,\n  WebhookResult,\n  WebhookPaymentData,\n  WebhookLinkData,\n} from './webhook.js';\n\n// PAYLINK Token\nexport {\n  PaylinkTokenManager,\n  createPaylinkTokenManager,\n  isPaylinkToken,\n  formatPaylinkAmount,\n  PAYLINK_TOKEN,\n  DEFAULT_DISCOUNT_TIERS,\n} from './paylink-token.js';\nexport type {\n  PaylinkTokenConfig,\n  DiscountTier,\n} from './paylink-token.js';\n\n// Utils\nexport {\n  generateId,\n  generateUUID,\n  generateNonce,\n  sign,\n  isExpired,\n  isLimitReached,\n  compareAmounts,\n  REASON_MESSAGES,\n} from './utils.js';\n","import express, { Express, Request, Response, NextFunction } from 'express';\nimport cors from 'cors';\nimport helmet from 'helmet';\nimport type {\n  PaylinkConfig,\n  PayLink,\n  Payment,\n  CreatePayLinkInput,\n  Protocol402Response,\n  Protocol403Response,\n  Storage,\n  ChainConfig,\n} from './types.js';\nimport { ReasonCode, SOLANA_CHAIN_IDS } from './types.js';\nimport { MemoryStorage } from './storage.js';\nimport { ChainVerifier, MockVerifier } from './chain.js';\nimport { SolanaVerifier, MockSolanaVerifier } from './providers/solana.js';\nimport { WebhookManager } from './webhook.js';\nimport { generatePaymentQR, generateQRCodeSVG, type PaymentQRData } from './qrcode.js';\nimport {\n  generateId,\n  generateUUID,\n  generateNonce,\n  sign,\n  isExpired,\n  isLimitReached,\n  REASON_MESSAGES,\n} from './utils.js';\n\ntype Verifier = ChainVerifier | MockVerifier | SolanaVerifier | MockSolanaVerifier;\n\n/**\n * Paylink Server\n * Self-hosted paid links with blockchain payment verification\n */\nexport class PaylinkServer {\n  private app: Express;\n  private config: Required<Omit<PaylinkConfig, 'chains' | 'webhook' | 'paylinkToken'>> & { \n    chains: PaylinkConfig['chains'];\n    webhook?: PaylinkConfig['webhook'];\n    paylinkToken?: PaylinkConfig['paylinkToken'];\n  };\n  private storage: Storage;\n  private verifiers: Map<number, Verifier>;\n  private webhookManager?: WebhookManager;\n\n  constructor(config: PaylinkConfig) {\n    // Default config\n    this.config = {\n      port: config.port ?? 3000,\n      baseUrl: config.baseUrl ?? '',\n      basePath: config.basePath ?? '/pay',\n      chains: config.chains,\n      paymentTimeout: config.paymentTimeout ?? 900,\n      signatureSecret: config.signatureSecret ?? '',\n      apiKey: config.apiKey ?? '',\n      cors: config.cors ?? true,\n      webhook: config.webhook,\n      paylinkToken: config.paylinkToken,\n    };\n\n    this.storage = new MemoryStorage();\n    this.verifiers = new Map();\n\n    // Initialize webhook manager\n    if (config.webhook?.url) {\n      this.webhookManager = new WebhookManager(config.webhook);\n    }\n\n    // Initialize chain verifiers\n    for (const chain of config.chains) {\n      this.verifiers.set(chain.chainId, this.createVerifier(chain));\n    }\n\n    this.app = express();\n    this.setupMiddleware();\n    this.setupRoutes();\n  }\n\n  /**\n   * Create appropriate verifier based on chain type\n   */\n  private createVerifier(chain: ChainConfig): Verifier {\n    const isSolana = chain.type === 'solana' || this.isSolanaChainId(chain.chainId);\n    \n    if (chain.rpcUrl === 'mock') {\n      return isSolana ? new MockSolanaVerifier() : new MockVerifier();\n    }\n    \n    if (isSolana) {\n      return new SolanaVerifier({\n        rpcUrl: chain.rpcUrl,\n        confirmations: chain.confirmations,\n      });\n    }\n    \n    return new ChainVerifier(chain);\n  }\n\n  /**\n   * Check if chain ID is a Solana chain\n   */\n  private isSolanaChainId(chainId: number): boolean {\n    return chainId === SOLANA_CHAIN_IDS.MAINNET ||\n           chainId === SOLANA_CHAIN_IDS.DEVNET ||\n           chainId === SOLANA_CHAIN_IDS.TESTNET;\n  }\n\n  /**\n   * Get Express app instance\n   */\n  getApp(): Express {\n    return this.app;\n  }\n\n  /**\n   * Get storage instance\n   */\n  getStorage(): Storage {\n    return this.storage;\n  }\n\n  /**\n   * Set custom storage\n   */\n  setStorage(storage: Storage): void {\n    this.storage = storage;\n  }\n\n  /**\n   * Start server\n   */\n  start(): void {\n    this.app.listen(this.config.port, () => {\n      console.log('');\n      console.log('╔══════════════════════════════════════════════════════════╗');\n      console.log('║              Paylink Protocol Server v1.1.0              ║');\n      console.log('╠══════════════════════════════════════════════════════════╣');\n      console.log(`║  Port:     ${String(this.config.port).padEnd(44)}║`);\n      console.log(`║  Base URL: ${(this.config.baseUrl || 'http://localhost:' + this.config.port).padEnd(44)}║`);\n      console.log(`║  Chains:   ${this.config.chains.map(c => c.name).join(', ').padEnd(44)}║`);\n      if (this.webhookManager) {\n        console.log(`║  Webhook:  ${this.config.webhook?.url?.substring(0, 44).padEnd(44)}║`);\n      }\n      console.log('╚══════════════════════════════════════════════════════════╝');\n      console.log('');\n      console.log('Endpoints:');\n      console.log(`  GET  ${this.config.basePath}/:id          → Payment page (402/403/302)`);\n      console.log(`  GET  ${this.config.basePath}/:id/status   → Check payment status`);\n      console.log(`  POST ${this.config.basePath}/:id/confirm  → Confirm with txHash`);\n      console.log(`  GET  ${this.config.basePath}/:id/qr       → QR code for payment`);\n      console.log('');\n      if (this.config.apiKey) {\n        console.log('Admin API (X-API-Key header required):');\n        console.log('  POST   /api/links       → Create link');\n        console.log('  GET    /api/links       → List links');\n        console.log('  GET    /api/links/:id   → Get link');\n        console.log('  DELETE /api/links/:id   → Disable link');\n        console.log('  GET    /api/payments    → List payments');\n        console.log('');\n      }\n    });\n  }\n\n  // ========================================\n  // PAYLINK METHODS\n  // ========================================\n\n  /**\n   * Create a new payment link\n   */\n  async createPayLink(input: CreatePayLinkInput): Promise<PayLink> {\n    const now = new Date();\n    \n    const payLink: PayLink = {\n      id: generateId(),\n      targetUrl: input.targetUrl,\n      price: input.price,\n      recipientAddress: input.recipientAddress,\n      status: 'active',\n      createdAt: now,\n      updatedAt: now,\n      description: input.description,\n      maxUses: input.maxUses,\n      usedCount: 0,\n      expiresAt: input.expiresAt,\n      metadata: input.metadata,\n    };\n\n    await this.storage.savePayLink(payLink);\n\n    // Send webhook notification\n    if (this.webhookManager) {\n      this.webhookManager.sendLinkEvent('link.created', payLink).catch(err => {\n        console.error('Webhook error:', err);\n      });\n    }\n\n    return payLink;\n  }\n\n  /**\n   * Get payment link by ID\n   */\n  async getPayLink(id: string): Promise<PayLink | null> {\n    return this.storage.getPayLink(id);\n  }\n\n  /**\n   * Disable a payment link\n   */\n  async disablePayLink(id: string): Promise<void> {\n    const link = await this.storage.getPayLink(id);\n    if (!link) throw new Error('Link not found');\n    \n    link.status = 'disabled';\n    await this.storage.updatePayLink(link);\n\n    // Send webhook notification\n    if (this.webhookManager) {\n      this.webhookManager.sendLinkEvent('link.disabled', link).catch(err => {\n        console.error('Webhook error:', err);\n      });\n    }\n  }\n\n  // ========================================\n  // PRIVATE METHODS\n  // ========================================\n\n  private setupMiddleware(): void {\n    this.app.use(helmet());\n    \n    if (this.config.cors) {\n      this.app.use(cors({ origin: '*', methods: ['GET', 'POST', 'DELETE'] }));\n    }\n    \n    this.app.use(express.json());\n    this.app.set('trust proxy', 1);\n\n    // Request logging\n    this.app.use((req, res, next) => {\n      const start = Date.now();\n      res.on('finish', () => {\n        console.log(`${req.method} ${req.path} ${res.statusCode} ${Date.now() - start}ms`);\n      });\n      next();\n    });\n  }\n\n  private setupRoutes(): void {\n    // Health check\n    this.app.get('/health', (req, res) => {\n      res.json({ status: 'ok', timestamp: new Date().toISOString() });\n    });\n\n    // API info\n    this.app.get('/', (req, res) => {\n      const base = this.config.baseUrl || `http://localhost:${this.config.port}`;\n      res.json({\n        name: 'Paylink Protocol',\n        version: '1.0.0',\n        chains: this.config.chains.map(c => ({ id: c.chainId, name: c.name, symbol: c.symbol })),\n        endpoints: {\n          paylink: `${base}${this.config.basePath}/:id`,\n          status: `${base}${this.config.basePath}/:id/status`,\n          confirm: `${base}${this.config.basePath}/:id/confirm`,\n        },\n      });\n    });\n\n    // Paylink routes\n    this.app.get(`${this.config.basePath}/:id`, this.handlePayLink.bind(this));\n    this.app.get(`${this.config.basePath}/:id/status`, this.handleStatus.bind(this));\n    this.app.post(`${this.config.basePath}/:id/confirm`, this.handleConfirm.bind(this));\n    this.app.get(`${this.config.basePath}/:id/qr`, this.handleQRCode.bind(this));\n\n    // Admin API\n    if (this.config.apiKey) {\n      const auth = this.authMiddleware.bind(this);\n      this.app.post('/api/links', auth, this.apiCreateLink.bind(this));\n      this.app.get('/api/links', auth, this.apiListLinks.bind(this));\n      this.app.get('/api/links/:id', auth, this.apiGetLink.bind(this));\n      this.app.delete('/api/links/:id', auth, this.apiDeleteLink.bind(this));\n      this.app.get('/api/payments', auth, this.apiListPayments.bind(this));\n    }\n  }\n\n  private authMiddleware(req: Request, res: Response, next: NextFunction): void {\n    const key = req.headers['x-api-key'];\n    if (key !== this.config.apiKey) {\n      res.status(401).json({ error: 'Invalid API key' });\n      return;\n    }\n    next();\n  }\n\n  // ========================================\n  // PAYLINK HANDLERS\n  // ========================================\n\n  private async handlePayLink(req: Request, res: Response): Promise<void> {\n    try {\n      const link = await this.storage.getPayLink(req.params.id);\n\n      if (!link) {\n        res.status(404).json({ error: 'Payment link not found' });\n        return;\n      }\n\n      // Check if disabled\n      if (link.status !== 'active') {\n        this.send403(res, ReasonCode.LINK_DISABLED, link.id);\n        return;\n      }\n\n      // Check if expired\n      if (isExpired(link.expiresAt)) {\n        this.send403(res, ReasonCode.LINK_EXPIRED, link.id, {\n          expiredAt: link.expiresAt?.toISOString(),\n        });\n        return;\n      }\n\n      // Check usage limit\n      if (isLimitReached(link.usedCount, link.maxUses)) {\n        this.send403(res, ReasonCode.LINK_USAGE_LIMIT_REACHED, link.id, {\n          maxUses: link.maxUses,\n          usedCount: link.usedCount,\n        });\n        return;\n      }\n\n      // Check for confirmed payment\n      const payment = await this.storage.getConfirmedPayment(link.id);\n\n      if (payment) {\n        // Increment usage and redirect\n        link.usedCount = (link.usedCount ?? 0) + 1;\n        await this.storage.updatePayLink(link);\n        res.redirect(302, link.targetUrl);\n        return;\n      }\n\n      // No payment - return 402\n      this.send402(res, link);\n    } catch (error) {\n      console.error('PayLink error:', error);\n      res.status(500).json({ error: 'Internal server error' });\n    }\n  }\n\n  private async handleStatus(req: Request, res: Response): Promise<void> {\n    try {\n      const link = await this.storage.getPayLink(req.params.id);\n\n      if (!link) {\n        res.json({ status: 'not_found' });\n        return;\n      }\n\n      if (link.status !== 'active') {\n        res.json({ status: 'forbidden' });\n        return;\n      }\n\n      if (isExpired(link.expiresAt) || isLimitReached(link.usedCount, link.maxUses)) {\n        res.json({ status: 'forbidden' });\n        return;\n      }\n\n      const payment = await this.storage.getConfirmedPayment(link.id);\n      res.json({ status: payment ? 'paid' : 'unpaid' });\n    } catch (error) {\n      console.error('Status error:', error);\n      res.status(500).json({ error: 'Internal server error' });\n    }\n  }\n\n  private async handleConfirm(req: Request, res: Response): Promise<void> {\n    try {\n      const { txHash } = req.body;\n\n      if (!txHash || typeof txHash !== 'string') {\n        res.status(400).json({ status: 'failed', message: 'Missing txHash' });\n        return;\n      }\n\n      const link = await this.storage.getPayLink(req.params.id);\n\n      if (!link) {\n        res.status(404).json({ status: 'failed', message: 'Link not found' });\n        return;\n      }\n\n      // Check if already confirmed\n      const existing = await this.storage.getPaymentByTxHash(txHash);\n      if (existing?.confirmed) {\n        res.json({ status: 'confirmed', message: 'Already confirmed' });\n        return;\n      }\n\n      // Get verifier for chain\n      const verifier = this.verifiers.get(link.price.chainId);\n      if (!verifier) {\n        res.status(400).json({ status: 'failed', message: 'Chain not supported' });\n        return;\n      }\n\n      // Verify payment\n      const result = await verifier.verifyPayment({\n        txHash,\n        recipient: link.recipientAddress,\n        amount: link.price.amount,\n      });\n\n      switch (result.status) {\n        case 'confirmed': {\n          const payment: Payment = {\n            id: generateUUID(),\n            payLinkId: link.id,\n            chainId: link.price.chainId,\n            txHash,\n            fromAddress: result.fromAddress ?? '',\n            amount: result.actualAmount ?? link.price.amount,\n            confirmed: true,\n            createdAt: new Date(),\n            confirmedAt: new Date(),\n          };\n          await this.storage.savePayment(payment);\n          \n          // Send webhook notification\n          if (this.webhookManager) {\n            this.webhookManager.sendPaymentEvent('payment.confirmed', payment, link).catch(err => {\n              console.error('Webhook error:', err);\n            });\n          }\n          \n          res.json({ status: 'confirmed' });\n          break;\n        }\n        case 'pending':\n          // Send webhook for pending payment\n          if (this.webhookManager) {\n            const pendingPayment: Payment = {\n              id: generateUUID(),\n              payLinkId: link.id,\n              chainId: link.price.chainId,\n              txHash,\n              fromAddress: result.fromAddress ?? '',\n              amount: result.actualAmount ?? link.price.amount,\n              confirmed: false,\n              createdAt: new Date(),\n            };\n            this.webhookManager.sendPaymentEvent('payment.pending', pendingPayment, link).catch(err => {\n              console.error('Webhook error:', err);\n            });\n          }\n          res.status(202).json({ status: 'pending', message: 'Transaction pending' });\n          break;\n        case 'underpaid':\n          // Send webhook for underpaid\n          if (this.webhookManager) {\n            const underpaidPayment: Payment = {\n              id: generateUUID(),\n              payLinkId: link.id,\n              chainId: link.price.chainId,\n              txHash,\n              fromAddress: result.fromAddress ?? '',\n              amount: result.actualAmount ?? '0',\n              confirmed: false,\n              createdAt: new Date(),\n            };\n            this.webhookManager.sendPaymentEvent('payment.underpaid', underpaidPayment, link).catch(err => {\n              console.error('Webhook error:', err);\n            });\n          }\n          res.status(400).json({\n            status: 'failed',\n            message: `Underpaid: received ${result.actualAmount}, required ${link.price.amount}`,\n          });\n          break;\n        default:\n          res.status(400).json({ status: 'failed', message: 'Transaction not found or failed' });\n      }\n    } catch (error) {\n      console.error('Confirm error:', error);\n      res.status(500).json({ error: 'Internal server error' });\n    }\n  }\n\n  /**\n   * Handle QR code generation\n   */\n  private async handleQRCode(req: Request, res: Response): Promise<void> {\n    try {\n      const link = await this.storage.getPayLink(req.params.id);\n\n      if (!link) {\n        res.status(404).json({ error: 'Payment link not found' });\n        return;\n      }\n\n      if (link.status !== 'active') {\n        res.status(403).json({ error: 'Payment link is not active' });\n        return;\n      }\n\n      const base = this.config.baseUrl || `http://localhost:${this.config.port}`;\n      const format = req.query.format as string || 'svg';\n      const size = parseInt(req.query.size as string) || 256;\n\n      const qrData: PaymentQRData = {\n        chainId: link.price.chainId,\n        recipient: link.recipientAddress,\n        amount: link.price.amount,\n        tokenSymbol: link.price.tokenSymbol,\n        payLinkId: link.id,\n        confirmUrl: `${base}${this.config.basePath}/${link.id}/confirm`,\n      };\n\n      const qr = generatePaymentQR(qrData, { size });\n\n      if (format === 'json') {\n        res.json({\n          payLinkId: link.id,\n          paymentUri: qr.uri,\n          qrCodeDataUrl: qr.dataUrl,\n          payment: {\n            chainId: link.price.chainId,\n            tokenSymbol: link.price.tokenSymbol,\n            amount: link.price.amount,\n            recipient: link.recipientAddress,\n          },\n        });\n        return;\n      }\n\n      // Return SVG directly\n      res.set({\n        'Content-Type': 'image/svg+xml',\n        'Cache-Control': 'public, max-age=300',\n      });\n      res.send(qr.svg);\n    } catch (error) {\n      console.error('QR code error:', error);\n      res.status(500).json({ error: 'Internal server error' });\n    }\n  }\n\n  // ========================================\n  // ADMIN API HANDLERS\n  // ========================================\n\n  private async apiCreateLink(req: Request, res: Response): Promise<void> {\n    try {\n      const {\n        targetUrl,\n        amount,\n        tokenSymbol = 'ETH',\n        chainId = 1,\n        recipientAddress,\n        description,\n        maxUses,\n        expiresIn,\n      } = req.body;\n\n      if (!targetUrl || !amount || !recipientAddress) {\n        res.status(400).json({ error: 'Missing: targetUrl, amount, or recipientAddress' });\n        return;\n      }\n\n      const link = await this.createPayLink({\n        targetUrl,\n        price: { amount: String(amount), tokenSymbol, chainId: Number(chainId) },\n        recipientAddress,\n        description,\n        maxUses: maxUses ? Number(maxUses) : undefined,\n        expiresAt: expiresIn ? new Date(Date.now() + Number(expiresIn) * 1000) : undefined,\n      });\n\n      const base = this.config.baseUrl || `http://localhost:${this.config.port}`;\n\n      res.status(201).json({\n        success: true,\n        link: {\n          id: link.id,\n          url: `${base}${this.config.basePath}/${link.id}`,\n          targetUrl: link.targetUrl,\n          price: link.price,\n          recipientAddress: link.recipientAddress,\n          description: link.description,\n          maxUses: link.maxUses,\n          expiresAt: link.expiresAt?.toISOString(),\n        },\n      });\n    } catch (error) {\n      console.error('Create link error:', error);\n      res.status(500).json({ error: 'Internal server error' });\n    }\n  }\n\n  private async apiListLinks(req: Request, res: Response): Promise<void> {\n    const links = await this.storage.getAllPayLinks();\n    const base = this.config.baseUrl || `http://localhost:${this.config.port}`;\n\n    res.json({\n      count: links.length,\n      links: links.map(l => ({\n        id: l.id,\n        url: `${base}${this.config.basePath}/${l.id}`,\n        status: l.status,\n        price: l.price,\n        usedCount: l.usedCount,\n      })),\n    });\n  }\n\n  private async apiGetLink(req: Request, res: Response): Promise<void> {\n    const link = await this.storage.getPayLink(req.params.id);\n\n    if (!link) {\n      res.status(404).json({ error: 'Link not found' });\n      return;\n    }\n\n    const base = this.config.baseUrl || `http://localhost:${this.config.port}`;\n\n    res.json({\n      id: link.id,\n      url: `${base}${this.config.basePath}/${link.id}`,\n      targetUrl: link.targetUrl,\n      price: link.price,\n      recipientAddress: link.recipientAddress,\n      status: link.status,\n      usedCount: link.usedCount,\n      maxUses: link.maxUses,\n      expiresAt: link.expiresAt?.toISOString(),\n      createdAt: link.createdAt.toISOString(),\n    });\n  }\n\n  private async apiDeleteLink(req: Request, res: Response): Promise<void> {\n    try {\n      await this.disablePayLink(req.params.id);\n      res.json({ success: true });\n    } catch {\n      res.status(404).json({ error: 'Link not found' });\n    }\n  }\n\n  private async apiListPayments(req: Request, res: Response): Promise<void> {\n    const payments = await this.storage.getAllPayments();\n\n    res.json({\n      count: payments.length,\n      payments: payments.map(p => ({\n        id: p.id,\n        payLinkId: p.payLinkId,\n        txHash: p.txHash,\n        amount: p.amount,\n        confirmed: p.confirmed,\n        createdAt: p.createdAt.toISOString(),\n      })),\n    });\n  }\n\n  // ========================================\n  // RESPONSE HELPERS\n  // ========================================\n\n  private send402(res: Response, link: PayLink): void {\n    const base = this.config.baseUrl || `http://localhost:${this.config.port}`;\n    const nonce = generateNonce();\n\n    const body: Protocol402Response = {\n      protocol: '402-paylink-v1',\n      payLinkId: link.id,\n      resource: {\n        description: link.description,\n        preview: null,\n      },\n      payment: {\n        chainId: link.price.chainId,\n        tokenSymbol: link.price.tokenSymbol,\n        amount: link.price.amount,\n        recipient: link.recipientAddress,\n        timeoutSeconds: this.config.paymentTimeout,\n      },\n      callbacks: {\n        status: `${base}${this.config.basePath}/${link.id}/status`,\n        confirm: `${base}${this.config.basePath}/${link.id}/confirm`,\n      },\n      nonce,\n    };\n\n    if (this.config.signatureSecret) {\n      const data = JSON.stringify({ payLinkId: body.payLinkId, payment: body.payment, nonce });\n      body.signature = sign(data, this.config.signatureSecret);\n    }\n\n    res.set({\n      'Content-Type': 'application/json; charset=utf-8',\n      'X-Paylink-Protocol': '402-v1',\n    });\n    res.status(402).json(body);\n  }\n\n  private send403(\n    res: Response,\n    code: ReasonCode,\n    payLinkId?: string,\n    details?: Record<string, unknown>\n  ): void {\n    const body: Protocol403Response = {\n      protocol: '403-paylink-v1',\n      payLinkId,\n      reasonCode: code,\n      reasonMessage: REASON_MESSAGES[code] ?? 'Forbidden',\n      details,\n    };\n\n    res.set({\n      'Content-Type': 'application/json; charset=utf-8',\n      'X-Paylink-Protocol': '403-v1',\n    });\n    res.status(403).json(body);\n  }\n}\n\n/**\n * Create and start a paylink server\n */\nexport function createServer(config: PaylinkConfig): PaylinkServer {\n  return new PaylinkServer(config);\n}\n","/**\n * Payment link status\n */\nexport type PayLinkStatus = 'active' | 'disabled' | 'expired';\n\n/**\n * Payment verification status\n */\nexport type PaymentStatus = 'not_found' | 'pending' | 'confirmed' | 'failed' | 'underpaid';\n\n/**\n * Chain type\n */\nexport type ChainType = 'evm' | 'solana';\n\n/**\n * Supported chain configuration\n */\nexport interface ChainConfig {\n  chainId: number;\n  name: string;\n  rpcUrl: string;\n  symbol: string;\n  confirmations?: number;\n  /** Chain type (default: 'evm') */\n  type?: ChainType;\n}\n\n/**\n * Solana chain IDs\n * 101 = Mainnet, 102 = Devnet, 103 = Testnet\n */\nexport const SOLANA_CHAIN_IDS = {\n  MAINNET: 101,\n  DEVNET: 102,\n  TESTNET: 103,\n} as const;\n\n/**\n * Price configuration\n */\nexport interface Price {\n  amount: string;\n  tokenSymbol: string;\n  chainId: number;\n}\n\n/**\n * Payment link entity\n */\nexport interface PayLink {\n  id: string;\n  targetUrl: string;\n  price: Price;\n  recipientAddress: string;\n  status: PayLinkStatus;\n  createdAt: Date;\n  updatedAt: Date;\n  description?: string;\n  maxUses?: number;\n  usedCount?: number;\n  expiresAt?: Date;\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * Payment record\n */\nexport interface Payment {\n  id: string;\n  payLinkId: string;\n  chainId: number;\n  txHash: string;\n  fromAddress: string;\n  amount: string;\n  confirmed: boolean;\n  createdAt: Date;\n  confirmedAt?: Date;\n}\n\n/**\n * Input for creating a payment link\n */\nexport interface CreatePayLinkInput {\n  targetUrl: string;\n  price: Price;\n  recipientAddress: string;\n  description?: string;\n  maxUses?: number;\n  expiresAt?: Date;\n  metadata?: Record<string, unknown>;\n}\n\n/**\n * 402 Protocol response\n */\nexport interface Protocol402Response {\n  protocol: '402-paylink-v1';\n  payLinkId: string;\n  resource: {\n    description?: string;\n    preview?: string | null;\n  };\n  payment: {\n    chainId: number;\n    tokenSymbol: string;\n    amount: string;\n    recipient: string;\n    timeoutSeconds: number;\n  };\n  callbacks: {\n    status: string;\n    confirm: string;\n  };\n  nonce: string;\n  signature?: string;\n}\n\n/**\n * 403 Reason codes\n */\nexport enum ReasonCode {\n  LINK_NOT_FOUND = 'LINK_NOT_FOUND',\n  LINK_DISABLED = 'LINK_DISABLED',\n  LINK_EXPIRED = 'LINK_EXPIRED',\n  LINK_USAGE_LIMIT_REACHED = 'LINK_USAGE_LIMIT_REACHED',\n  PAYMENT_UNDERPAID = 'PAYMENT_UNDERPAID',\n  PAYMENT_CHAIN_NOT_SUPPORTED = 'PAYMENT_CHAIN_NOT_SUPPORTED',\n  ACCESS_DENIED = 'ACCESS_DENIED',\n  INTERNAL_ERROR = 'INTERNAL_ERROR',\n}\n\n/**\n * 403 Protocol response\n */\nexport interface Protocol403Response {\n  protocol: '403-paylink-v1';\n  payLinkId?: string;\n  reasonCode: ReasonCode;\n  reasonMessage: string;\n  details?: Record<string, unknown>;\n}\n\n/**\n * Webhook configuration\n */\nexport interface WebhookConfigType {\n  /** Webhook URL to send events to */\n  url: string;\n  /** Secret for HMAC signature */\n  secret?: string;\n  /** Events to send */\n  events?: Array<\n    | 'payment.confirmed'\n    | 'payment.pending'\n    | 'payment.failed'\n    | 'payment.underpaid'\n    | 'link.created'\n    | 'link.disabled'\n  >;\n  /** Request timeout in ms */\n  timeout?: number;\n  /** Retry count on failure */\n  retries?: number;\n}\n\n/**\n * PAYLINK token configuration\n */\nexport interface PaylinkTokenConfigType {\n  /** Enable PAYLINK token payments */\n  enabled?: boolean;\n  /** Discount when paying with PAYLINK token (percentage, 0-100) */\n  paymentDiscount?: number;\n  /** Enable holder discounts based on PAYLINK balance */\n  holderDiscounts?: boolean;\n  /** Custom discount tiers */\n  discountTiers?: Array<{\n    minBalance: number;\n    discountPercent: number;\n    name: string;\n  }>;\n}\n\n/**\n * Server configuration\n */\nexport interface PaylinkConfig {\n  /** Server port */\n  port?: number;\n  /** Base URL for callbacks (e.g., https://your-domain.com) */\n  baseUrl?: string;\n  /** Base path for paylink routes (default: /pay) */\n  basePath?: string;\n  /** Supported blockchain networks */\n  chains: ChainConfig[];\n  /** Payment timeout in seconds (default: 900) */\n  paymentTimeout?: number;\n  /** Secret for signing responses */\n  signatureSecret?: string;\n  /** API key for admin endpoints */\n  apiKey?: string;\n  /** Enable CORS (default: true) */\n  cors?: boolean;\n  /** Webhook configuration */\n  webhook?: WebhookConfigType;\n  /** PAYLINK token configuration */\n  paylinkToken?: PaylinkTokenConfigType;\n}\n\n/**\n * Payment check result\n */\nexport interface PaymentCheckResult {\n  status: PaymentStatus;\n  actualAmount?: string;\n  fromAddress?: string;\n  raw?: unknown;\n}\n\n/**\n * Storage interface\n */\nexport interface Storage {\n  getPayLink(id: string): Promise<PayLink | null>;\n  savePayLink(payLink: PayLink): Promise<void>;\n  updatePayLink(payLink: PayLink): Promise<void>;\n  deletePayLink(id: string): Promise<void>;\n  getAllPayLinks(): Promise<PayLink[]>;\n  \n  savePayment(payment: Payment): Promise<void>;\n  getPaymentByTxHash(txHash: string): Promise<Payment | null>;\n  getConfirmedPayment(payLinkId: string): Promise<Payment | null>;\n  getAllPayments(): Promise<Payment[]>;\n}\n","import type { Storage, PayLink, Payment } from './types.js';\n\n/**\n * In-memory storage implementation\n * Replace with database for production\n */\nexport class MemoryStorage implements Storage {\n  private links = new Map<string, PayLink>();\n  private payments = new Map<string, Payment>();\n  private paymentsByTx = new Map<string, Payment>();\n  private paymentsByLink = new Map<string, Payment[]>();\n\n  async getPayLink(id: string): Promise<PayLink | null> {\n    return this.links.get(id) ?? null;\n  }\n\n  async savePayLink(payLink: PayLink): Promise<void> {\n    this.links.set(payLink.id, { ...payLink });\n  }\n\n  async updatePayLink(payLink: PayLink): Promise<void> {\n    if (!this.links.has(payLink.id)) {\n      throw new Error(`PayLink ${payLink.id} not found`);\n    }\n    this.links.set(payLink.id, { ...payLink, updatedAt: new Date() });\n  }\n\n  async deletePayLink(id: string): Promise<void> {\n    this.links.delete(id);\n  }\n\n  async getAllPayLinks(): Promise<PayLink[]> {\n    return Array.from(this.links.values());\n  }\n\n  async savePayment(payment: Payment): Promise<void> {\n    this.payments.set(payment.id, { ...payment });\n    this.paymentsByTx.set(payment.txHash, payment);\n    \n    const list = this.paymentsByLink.get(payment.payLinkId) ?? [];\n    list.push(payment);\n    this.paymentsByLink.set(payment.payLinkId, list);\n  }\n\n  async getPaymentByTxHash(txHash: string): Promise<Payment | null> {\n    return this.paymentsByTx.get(txHash) ?? null;\n  }\n\n  async getConfirmedPayment(payLinkId: string): Promise<Payment | null> {\n    const list = this.paymentsByLink.get(payLinkId) ?? [];\n    return list.find(p => p.confirmed) ?? null;\n  }\n\n  async getAllPayments(): Promise<Payment[]> {\n    return Array.from(this.payments.values());\n  }\n\n  /** Clear all data */\n  clear(): void {\n    this.links.clear();\n    this.payments.clear();\n    this.paymentsByTx.clear();\n    this.paymentsByLink.clear();\n  }\n}\n","import { randomBytes, createHmac, randomUUID } from 'crypto';\n\n/**\n * Generate short unique ID\n */\nexport function generateId(length = 8): string {\n  const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n  const bytes = randomBytes(length);\n  let result = '';\n  for (let i = 0; i < length; i++) {\n    result += chars[bytes[i] % chars.length];\n  }\n  return result;\n}\n\n/**\n * Generate UUID\n */\nexport function generateUUID(): string {\n  return randomUUID();\n}\n\n/**\n * Generate nonce\n */\nexport function generateNonce(): string {\n  return randomBytes(16).toString('hex');\n}\n\n/**\n * Create HMAC signature\n */\nexport function sign(data: string, secret: string): string {\n  return createHmac('sha256', secret).update(data).digest('hex');\n}\n\n/**\n * Check if date is expired\n */\nexport function isExpired(date?: Date): boolean {\n  if (!date) return false;\n  return new Date() > new Date(date);\n}\n\n/**\n * Check if usage limit reached\n */\nexport function isLimitReached(used?: number, max?: number): boolean {\n  if (max === undefined) return false;\n  return (used ?? 0) >= max;\n}\n\n/**\n * Compare amounts\n */\nexport function compareAmounts(a: string, b: string): number {\n  const numA = parseFloat(a);\n  const numB = parseFloat(b);\n  if (numA < numB) return -1;\n  if (numA > numB) return 1;\n  return 0;\n}\n\n/**\n * Reason code messages\n */\nexport const REASON_MESSAGES: Record<string, string> = {\n  LINK_NOT_FOUND: 'Payment link not found.',\n  LINK_DISABLED: 'This payment link has been disabled.',\n  LINK_EXPIRED: 'This payment link has expired.',\n  LINK_USAGE_LIMIT_REACHED: 'This payment link has reached its usage limit.',\n  PAYMENT_UNDERPAID: 'Payment amount is less than required.',\n  PAYMENT_CHAIN_NOT_SUPPORTED: 'This blockchain is not supported.',\n  ACCESS_DENIED: 'Access denied.',\n  INTERNAL_ERROR: 'An internal error occurred.',\n};\n","import type { ChainConfig, PaymentCheckResult } from './types.js';\nimport { compareAmounts } from './utils.js';\n\n/**\n * Blockchain payment verifier\n */\nexport class ChainVerifier {\n  private config: ChainConfig;\n  private requestId = 0;\n\n  constructor(config: ChainConfig) {\n    this.config = config;\n  }\n\n  get chainId(): number {\n    return this.config.chainId;\n  }\n\n  /**\n   * Verify payment on chain\n   */\n  async verifyPayment(params: {\n    txHash: string;\n    recipient: string;\n    amount: string;\n  }): Promise<PaymentCheckResult> {\n    try {\n      // Get transaction\n      const tx = await this.rpc('eth_getTransactionByHash', [params.txHash]);\n      \n      if (!tx) {\n        return { status: 'not_found' };\n      }\n\n      // Not mined yet\n      if (!tx.blockNumber) {\n        return { status: 'pending' };\n      }\n\n      // Get receipt\n      const receipt = await this.rpc('eth_getTransactionReceipt', [params.txHash]);\n      \n      if (!receipt) {\n        return { status: 'pending' };\n      }\n\n      // Failed transaction\n      if (receipt.status === '0x0') {\n        return { status: 'failed' };\n      }\n\n      // Check confirmations\n      const currentBlock = await this.rpc('eth_blockNumber', []);\n      const txBlock = parseInt(tx.blockNumber, 16);\n      const current = parseInt(currentBlock, 16);\n      const confirmations = current - txBlock;\n\n      if (confirmations < (this.config.confirmations ?? 1)) {\n        return { status: 'pending' };\n      }\n\n      // Verify recipient\n      const recipientLower = params.recipient.toLowerCase();\n      const toAddress = (tx.to || '').toLowerCase();\n      \n      if (toAddress !== recipientLower) {\n        // Check if it's a token transfer\n        if (!this.isTokenTransfer(receipt, recipientLower)) {\n          return { status: 'not_found' };\n        }\n      }\n\n      // Calculate amount\n      const valueWei = BigInt(tx.value || '0');\n      const actualAmount = this.weiToEther(valueWei);\n\n      // Check amount\n      if (compareAmounts(actualAmount, params.amount) < 0) {\n        return {\n          status: 'underpaid',\n          actualAmount,\n          fromAddress: tx.from,\n        };\n      }\n\n      return {\n        status: 'confirmed',\n        actualAmount,\n        fromAddress: tx.from,\n        raw: { tx, receipt },\n      };\n    } catch (error) {\n      console.error(`Chain ${this.config.chainId} verification error:`, error);\n      return { status: 'not_found' };\n    }\n  }\n\n  private async rpc(method: string, params: unknown[]): Promise<any> {\n    const controller = new AbortController();\n    const timeout = setTimeout(() => controller.abort(), 30000);\n\n    try {\n      const response = await fetch(this.config.rpcUrl, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          jsonrpc: '2.0',\n          id: ++this.requestId,\n          method,\n          params,\n        }),\n        signal: controller.signal,\n      });\n\n      const data = await response.json() as { error?: { message: string }; result?: unknown };\n      \n      if (data.error) {\n        throw new Error(data.error.message);\n      }\n      \n      return data.result;\n    } finally {\n      clearTimeout(timeout);\n    }\n  }\n\n  private isTokenTransfer(receipt: any, recipient: string): boolean {\n    // ERC20 Transfer event signature\n    const transferTopic = '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef';\n    \n    for (const log of receipt.logs || []) {\n      if (log.topics?.[0] === transferTopic && log.topics.length >= 3) {\n        const to = '0x' + log.topics[2].slice(26).toLowerCase();\n        if (to === recipient) {\n          return true;\n        }\n      }\n    }\n    \n    return false;\n  }\n\n  private weiToEther(wei: bigint): string {\n    return (Number(wei) / 1e18).toString();\n  }\n}\n\n/**\n * Mock verifier for development/testing\n */\nexport class MockVerifier {\n  private confirmed = new Set<string>();\n  private pending = new Set<string>();\n  private failed = new Set<string>();\n\n  chainId = 1;\n\n  markConfirmed(txHash: string): void {\n    this.confirmed.add(txHash);\n    this.pending.delete(txHash);\n    this.failed.delete(txHash);\n  }\n\n  markPending(txHash: string): void {\n    this.pending.add(txHash);\n  }\n\n  markFailed(txHash: string): void {\n    this.failed.add(txHash);\n  }\n\n  async verifyPayment(params: {\n    txHash: string;\n    recipient: string;\n    amount: string;\n  }): Promise<PaymentCheckResult> {\n    await new Promise(r => setTimeout(r, 100));\n\n    if (this.failed.has(params.txHash)) {\n      return { status: 'failed' };\n    }\n\n    if (this.pending.has(params.txHash)) {\n      return { status: 'pending' };\n    }\n\n    // Auto-confirm for testing\n    return {\n      status: 'confirmed',\n      actualAmount: params.amount,\n      fromAddress: '0x' + 'a'.repeat(40),\n    };\n  }\n}\n","import type { PaymentCheckResult } from '../types.js';\nimport { compareAmounts } from '../utils.js';\n\n/**\n * Solana chain configuration\n */\nexport interface SolanaConfig {\n  /** RPC URL (e.g., https://api.mainnet-beta.solana.com) */\n  rpcUrl: string;\n  /** Number of confirmations required (default: 1) */\n  confirmations?: number;\n  /** Request timeout in ms (default: 30000) */\n  timeout?: number;\n}\n\ninterface JsonRpcResponse<T> {\n  jsonrpc: string;\n  id: number;\n  result?: T;\n  error?: {\n    code: number;\n    message: string;\n  };\n}\n\ninterface SolanaTransaction {\n  slot: number;\n  meta: {\n    err: null | object;\n    fee: number;\n    preBalances: number[];\n    postBalances: number[];\n    status: { Ok: null } | { Err: object };\n  } | null;\n  transaction: {\n    message: {\n      accountKeys: string[];\n      instructions: Array<{\n        programIdIndex: number;\n        accounts: number[];\n        data: string;\n      }>;\n    };\n    signatures: string[];\n  };\n  blockTime: number | null;\n}\n\ninterface SignatureStatus {\n  slot: number;\n  confirmations: number | null;\n  err: null | object;\n  confirmationStatus: 'processed' | 'confirmed' | 'finalized' | null;\n}\n\n/**\n * Solana Payment Verifier\n * Verifies native SOL transfers on Solana blockchain\n */\nexport class SolanaVerifier {\n  private config: Required<SolanaConfig>;\n  private requestId = 0;\n\n  constructor(config: SolanaConfig) {\n    this.config = {\n      rpcUrl: config.rpcUrl,\n      confirmations: config.confirmations ?? 1,\n      timeout: config.timeout ?? 30000,\n    };\n  }\n\n  /**\n   * Verify a Solana payment\n   */\n  async verifyPayment(params: {\n    txHash: string;\n    recipient: string;\n    amount: string;\n  }): Promise<PaymentCheckResult> {\n    try {\n      // Get transaction details\n      const tx = await this.getTransaction(params.txHash);\n\n      if (!tx) {\n        return { status: 'not_found' };\n      }\n\n      // Check if transaction failed\n      if (tx.meta?.err) {\n        return { status: 'failed' };\n      }\n\n      // Get signature status for confirmation count\n      const status = await this.getSignatureStatus(params.txHash);\n\n      if (!status) {\n        return { status: 'pending' };\n      }\n\n      // Check confirmations\n      const confirmations = status.confirmations ?? 0;\n      const isFinalized = status.confirmationStatus === 'finalized';\n\n      if (!isFinalized && confirmations < this.config.confirmations) {\n        return { status: 'pending' };\n      }\n\n      // Parse transaction to find recipient and amount\n      const { recipient: actualRecipient, amount: actualAmount, sender } = \n        this.parseTransfer(tx, params.recipient);\n\n      if (!actualRecipient) {\n        return { status: 'not_found' };\n      }\n\n      // Verify recipient matches\n      if (actualRecipient.toLowerCase() !== params.recipient.toLowerCase()) {\n        return { status: 'not_found' };\n      }\n\n      // Compare amounts (SOL has 9 decimals)\n      if (compareAmounts(actualAmount, params.amount) < 0) {\n        return {\n          status: 'underpaid',\n          actualAmount,\n          fromAddress: sender,\n          raw: tx,\n        };\n      }\n\n      return {\n        status: 'confirmed',\n        actualAmount,\n        fromAddress: sender,\n        raw: tx,\n      };\n    } catch (error) {\n      console.error('Solana verification error:', error);\n      return { status: 'not_found' };\n    }\n  }\n\n  /**\n   * Parse a Solana transaction to extract transfer details\n   */\n  private parseTransfer(\n    tx: SolanaTransaction,\n    expectedRecipient: string\n  ): { recipient: string | null; amount: string; sender: string } {\n    const accountKeys = tx.transaction.message.accountKeys;\n    const preBalances = tx.meta?.preBalances ?? [];\n    const postBalances = tx.meta?.postBalances ?? [];\n\n    // Find the expected recipient in account keys\n    const recipientIndex = accountKeys.findIndex(\n      key => key.toLowerCase() === expectedRecipient.toLowerCase()\n    );\n\n    if (recipientIndex === -1) {\n      return { recipient: null, amount: '0', sender: '' };\n    }\n\n    // Calculate amount received (in lamports)\n    const preBalance = preBalances[recipientIndex] ?? 0;\n    const postBalance = postBalances[recipientIndex] ?? 0;\n    const lamportsReceived = postBalance - preBalance;\n\n    if (lamportsReceived <= 0) {\n      return { recipient: null, amount: '0', sender: '' };\n    }\n\n    // Convert lamports to SOL (9 decimals)\n    const solAmount = lamportsReceived / 1e9;\n\n    // First account is typically the fee payer/sender\n    const sender = accountKeys[0] ?? '';\n\n    return {\n      recipient: expectedRecipient,\n      amount: solAmount.toString(),\n      sender,\n    };\n  }\n\n  /**\n   * Get transaction details from Solana RPC\n   */\n  private async getTransaction(signature: string): Promise<SolanaTransaction | null> {\n    return this.rpc<SolanaTransaction>('getTransaction', [\n      signature,\n      {\n        encoding: 'json',\n        commitment: 'confirmed',\n        maxSupportedTransactionVersion: 0,\n      },\n    ]);\n  }\n\n  /**\n   * Get signature status\n   */\n  private async getSignatureStatus(signature: string): Promise<SignatureStatus | null> {\n    const result = await this.rpc<{ value: Array<SignatureStatus | null> }>(\n      'getSignatureStatuses',\n      [[signature]]\n    );\n    return result?.value?.[0] ?? null;\n  }\n\n  /**\n   * Make an RPC call to Solana\n   */\n  private async rpc<T>(method: string, params: unknown[]): Promise<T | null> {\n    const controller = new AbortController();\n    const timeout = setTimeout(() => controller.abort(), this.config.timeout);\n\n    try {\n      const response = await fetch(this.config.rpcUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          jsonrpc: '2.0',\n          id: ++this.requestId,\n          method,\n          params,\n        }),\n        signal: controller.signal,\n      });\n\n      const data = (await response.json()) as JsonRpcResponse<T>;\n\n      if (data.error) {\n        console.error('Solana RPC error:', data.error);\n        return null;\n      }\n\n      return data.result ?? null;\n    } catch (error) {\n      if ((error as Error).name === 'AbortError') {\n        console.error('Solana RPC request timeout');\n      } else {\n        console.error('Solana RPC error:', error);\n      }\n      return null;\n    } finally {\n      clearTimeout(timeout);\n    }\n  }\n}\n\n/**\n * Mock Solana verifier for testing\n */\nexport class MockSolanaVerifier {\n  private confirmed = new Set<string>();\n  private pending = new Set<string>();\n  private failed = new Set<string>();\n\n  markConfirmed(signature: string): void {\n    this.confirmed.add(signature);\n    this.pending.delete(signature);\n    this.failed.delete(signature);\n  }\n\n  markPending(signature: string): void {\n    this.pending.add(signature);\n  }\n\n  markFailed(signature: string): void {\n    this.failed.add(signature);\n  }\n\n  async verifyPayment(params: {\n    txHash: string;\n    recipient: string;\n    amount: string;\n  }): Promise<PaymentCheckResult> {\n    await new Promise(r => setTimeout(r, 100));\n\n    if (this.failed.has(params.txHash)) {\n      return { status: 'failed' };\n    }\n\n    if (this.pending.has(params.txHash)) {\n      return { status: 'pending' };\n    }\n\n    // Auto-confirm for testing\n    return {\n      status: 'confirmed',\n      actualAmount: params.amount,\n      fromAddress: 'So11111111111111111111111111111111111111112',\n    };\n  }\n}\n\n/**\n * Create a Solana verifier\n */\nexport function createSolanaVerifier(config: SolanaConfig): SolanaVerifier {\n  return new SolanaVerifier(config);\n}\n","import { createHmac } from 'crypto';\nimport type { PayLink, Payment } from './types.js';\n\n/**\n * Webhook configuration\n */\nexport interface WebhookConfig {\n  /** Webhook URL to send events to */\n  url: string;\n  /** Secret for HMAC signature */\n  secret?: string;\n  /** Events to send (default: all) */\n  events?: WebhookEvent[];\n  /** Request timeout in ms (default: 10000) */\n  timeout?: number;\n  /** Retry count on failure (default: 3) */\n  retries?: number;\n  /** Custom headers to include */\n  headers?: Record<string, string>;\n}\n\n/**\n * Webhook event types\n */\nexport type WebhookEvent =\n  | 'payment.confirmed'\n  | 'payment.pending'\n  | 'payment.failed'\n  | 'payment.underpaid'\n  | 'link.created'\n  | 'link.disabled'\n  | 'link.expired';\n\n/**\n * Webhook payload base\n */\nexport interface WebhookPayload {\n  /** Event type */\n  event: WebhookEvent;\n  /** Event timestamp */\n  timestamp: string;\n  /** Unique event ID */\n  eventId: string;\n  /** Event data */\n  data: WebhookPaymentData | WebhookLinkData;\n}\n\n/**\n * Payment event data\n */\nexport interface WebhookPaymentData {\n  type: 'payment';\n  payment: {\n    id: string;\n    payLinkId: string;\n    chainId: number;\n    txHash: string;\n    fromAddress: string;\n    amount: string;\n    confirmed: boolean;\n    createdAt: string;\n    confirmedAt?: string;\n  };\n  payLink: {\n    id: string;\n    targetUrl: string;\n    price: {\n      amount: string;\n      tokenSymbol: string;\n      chainId: number;\n    };\n    recipientAddress: string;\n  };\n}\n\n/**\n * Link event data\n */\nexport interface WebhookLinkData {\n  type: 'link';\n  link: {\n    id: string;\n    targetUrl: string;\n    price: {\n      amount: string;\n      tokenSymbol: string;\n      chainId: number;\n    };\n    recipientAddress: string;\n    status: string;\n    createdAt: string;\n    description?: string;\n    maxUses?: number;\n    expiresAt?: string;\n  };\n}\n\n/**\n * Webhook delivery result\n */\nexport interface WebhookResult {\n  success: boolean;\n  statusCode?: number;\n  error?: string;\n  attempts: number;\n  duration: number;\n}\n\n/**\n * Webhook Manager\n * Handles sending webhook notifications for payment events\n */\nexport class WebhookManager {\n  private config: Required<Omit<WebhookConfig, 'secret' | 'headers'>> & {\n    secret?: string;\n    headers?: Record<string, string>;\n  };\n  private queue: Array<{ payload: WebhookPayload; attempt: number }> = [];\n  private processing = false;\n\n  constructor(config: WebhookConfig) {\n    this.config = {\n      url: config.url,\n      secret: config.secret,\n      events: config.events ?? [\n        'payment.confirmed',\n        'payment.pending',\n        'payment.failed',\n        'payment.underpaid',\n        'link.created',\n        'link.disabled',\n      ],\n      timeout: config.timeout ?? 10000,\n      retries: config.retries ?? 3,\n      headers: config.headers,\n    };\n  }\n\n  /**\n   * Check if event type is enabled\n   */\n  isEventEnabled(event: WebhookEvent): boolean {\n    return this.config.events.includes(event);\n  }\n\n  /**\n   * Send payment event\n   */\n  async sendPaymentEvent(\n    event: WebhookEvent,\n    payment: Payment,\n    payLink: PayLink\n  ): Promise<WebhookResult | null> {\n    if (!this.isEventEnabled(event)) {\n      return null;\n    }\n\n    const payload: WebhookPayload = {\n      event,\n      timestamp: new Date().toISOString(),\n      eventId: this.generateEventId(),\n      data: {\n        type: 'payment',\n        payment: {\n          id: payment.id,\n          payLinkId: payment.payLinkId,\n          chainId: payment.chainId,\n          txHash: payment.txHash,\n          fromAddress: payment.fromAddress,\n          amount: payment.amount,\n          confirmed: payment.confirmed,\n          createdAt: payment.createdAt.toISOString(),\n          confirmedAt: payment.confirmedAt?.toISOString(),\n        },\n        payLink: {\n          id: payLink.id,\n          targetUrl: payLink.targetUrl,\n          price: payLink.price,\n          recipientAddress: payLink.recipientAddress,\n        },\n      },\n    };\n\n    return this.send(payload);\n  }\n\n  /**\n   * Send link event\n   */\n  async sendLinkEvent(\n    event: WebhookEvent,\n    payLink: PayLink\n  ): Promise<WebhookResult | null> {\n    if (!this.isEventEnabled(event)) {\n      return null;\n    }\n\n    const payload: WebhookPayload = {\n      event,\n      timestamp: new Date().toISOString(),\n      eventId: this.generateEventId(),\n      data: {\n        type: 'link',\n        link: {\n          id: payLink.id,\n          targetUrl: payLink.targetUrl,\n          price: payLink.price,\n          recipientAddress: payLink.recipientAddress,\n          status: payLink.status,\n          createdAt: payLink.createdAt.toISOString(),\n          description: payLink.description,\n          maxUses: payLink.maxUses,\n          expiresAt: payLink.expiresAt?.toISOString(),\n        },\n      },\n    };\n\n    return this.send(payload);\n  }\n\n  /**\n   * Queue event for async delivery\n   */\n  queueEvent(payload: WebhookPayload): void {\n    this.queue.push({ payload, attempt: 0 });\n    this.processQueue();\n  }\n\n  /**\n   * Send webhook with retries\n   */\n  async send(payload: WebhookPayload): Promise<WebhookResult> {\n    const startTime = Date.now();\n    let lastError: string | undefined;\n    let lastStatusCode: number | undefined;\n\n    for (let attempt = 1; attempt <= this.config.retries; attempt++) {\n      try {\n        const result = await this.deliver(payload);\n        \n        if (result.success) {\n          return {\n            success: true,\n            statusCode: result.statusCode,\n            attempts: attempt,\n            duration: Date.now() - startTime,\n          };\n        }\n\n        lastStatusCode = result.statusCode;\n        lastError = result.error;\n\n        // Don't retry on 4xx errors (client errors)\n        if (result.statusCode && result.statusCode >= 400 && result.statusCode < 500) {\n          break;\n        }\n\n        // Wait before retry (exponential backoff)\n        if (attempt < this.config.retries) {\n          await this.delay(Math.pow(2, attempt) * 1000);\n        }\n      } catch (error) {\n        lastError = (error as Error).message;\n        \n        if (attempt < this.config.retries) {\n          await this.delay(Math.pow(2, attempt) * 1000);\n        }\n      }\n    }\n\n    return {\n      success: false,\n      statusCode: lastStatusCode,\n      error: lastError,\n      attempts: this.config.retries,\n      duration: Date.now() - startTime,\n    };\n  }\n\n  /**\n   * Deliver webhook\n   */\n  private async deliver(\n    payload: WebhookPayload\n  ): Promise<{ success: boolean; statusCode?: number; error?: string }> {\n    const controller = new AbortController();\n    const timeout = setTimeout(() => controller.abort(), this.config.timeout);\n\n    try {\n      const body = JSON.stringify(payload);\n      const headers: Record<string, string> = {\n        'Content-Type': 'application/json',\n        'User-Agent': 'Paylink-Webhook/1.1.0',\n        'X-Paylink-Event': payload.event,\n        'X-Paylink-Event-Id': payload.eventId,\n        'X-Paylink-Timestamp': payload.timestamp,\n        ...this.config.headers,\n      };\n\n      // Add HMAC signature if secret is configured\n      if (this.config.secret) {\n        headers['X-Paylink-Signature'] = this.sign(body);\n      }\n\n      const response = await fetch(this.config.url, {\n        method: 'POST',\n        headers,\n        body,\n        signal: controller.signal,\n      });\n\n      if (response.ok) {\n        return { success: true, statusCode: response.status };\n      }\n\n      return {\n        success: false,\n        statusCode: response.status,\n        error: `HTTP ${response.status}: ${response.statusText}`,\n      };\n    } catch (error) {\n      if ((error as Error).name === 'AbortError') {\n        return { success: false, error: 'Request timeout' };\n      }\n      return { success: false, error: (error as Error).message };\n    } finally {\n      clearTimeout(timeout);\n    }\n  }\n\n  /**\n   * Sign payload with HMAC-SHA256\n   */\n  private sign(body: string): string {\n    if (!this.config.secret) return '';\n    return createHmac('sha256', this.config.secret).update(body).digest('hex');\n  }\n\n  /**\n   * Generate unique event ID\n   */\n  private generateEventId(): string {\n    const timestamp = Date.now().toString(36);\n    const random = Math.random().toString(36).substring(2, 10);\n    return `evt_${timestamp}_${random}`;\n  }\n\n  /**\n   * Process queued events\n   */\n  private async processQueue(): Promise<void> {\n    if (this.processing) return;\n    this.processing = true;\n\n    while (this.queue.length > 0) {\n      const item = this.queue.shift();\n      if (!item) continue;\n\n      const result = await this.send(item.payload);\n      \n      if (!result.success) {\n        console.error(\n          `Webhook delivery failed for ${item.payload.event}:`,\n          result.error\n        );\n      }\n    }\n\n    this.processing = false;\n  }\n\n  /**\n   * Delay helper\n   */\n  private delay(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n}\n\n/**\n * Verify webhook signature\n * Use this in your webhook handler to verify authenticity\n */\nexport function verifyWebhookSignature(\n  body: string,\n  signature: string,\n  secret: string\n): boolean {\n  const expected = createHmac('sha256', secret).update(body).digest('hex');\n  \n  // Constant-time comparison to prevent timing attacks\n  if (signature.length !== expected.length) return false;\n  \n  let result = 0;\n  for (let i = 0; i < signature.length; i++) {\n    result |= signature.charCodeAt(i) ^ expected.charCodeAt(i);\n  }\n  \n  return result === 0;\n}\n\n/**\n * Create a webhook manager\n */\nexport function createWebhookManager(config: WebhookConfig): WebhookManager {\n  return new WebhookManager(config);\n}\n","/**\n * QR Code Generator\n * Generates QR codes for payment links with wallet deep links\n */\n\n// QR Code matrix generation using Reed-Solomon error correction\n// This is a pure TypeScript implementation without external dependencies\n\nconst EC_LEVEL = 1; // M = ~15% error correction\nconst MODE_BYTE = 4; // Byte mode indicator\n\n/**\n * QR Code options\n */\nexport interface QRCodeOptions {\n  /** Size in pixels (default: 256) */\n  size?: number;\n  /** Margin in modules (default: 4) */\n  margin?: number;\n  /** Dark color (default: #000000) */\n  darkColor?: string;\n  /** Light color (default: #ffffff) */\n  lightColor?: string;\n  /** Output format */\n  format?: 'svg' | 'png-base64';\n}\n\n/**\n * Payment QR data\n */\nexport interface PaymentQRData {\n  /** Chain ID */\n  chainId: number;\n  /** Recipient address */\n  recipient: string;\n  /** Amount to pay */\n  amount: string;\n  /** Token symbol */\n  tokenSymbol: string;\n  /** Payment link ID */\n  payLinkId: string;\n  /** Callback URL for confirmation */\n  confirmUrl: string;\n}\n\n/**\n * Generate a payment URI for wallets\n */\nexport function generatePaymentURI(data: PaymentQRData): string {\n  const { chainId, recipient, amount, tokenSymbol } = data;\n\n  // Solana (chainId 101 = mainnet, 102 = devnet, 103 = testnet)\n  if (chainId >= 101 && chainId <= 103) {\n    // Solana Pay URI format\n    // solana:<recipient>?amount=<amount>&label=<label>&message=<message>\n    const params = new URLSearchParams({\n      amount: amount,\n      label: 'Paylink Payment',\n      message: `Payment for ${data.payLinkId}`,\n    });\n    return `solana:${recipient}?${params.toString()}`;\n  }\n\n  // EVM chains - use EIP-681 format\n  // ethereum:<address>@<chainId>/transfer?value=<value>\n  const weiAmount = parseFloat(amount) * 1e18;\n  \n  // Determine scheme based on chain\n  let scheme = 'ethereum';\n  if (chainId === 137 || chainId === 80001) {\n    scheme = 'polygon';\n  } else if (chainId === 56 || chainId === 97) {\n    scheme = 'bnb';\n  } else if (chainId === 42161 || chainId === 421613) {\n    scheme = 'arbitrum';\n  }\n\n  return `${scheme}:${recipient}@${chainId}?value=${weiAmount.toFixed(0)}`;\n}\n\n/**\n * Generate QR code as SVG\n */\nexport function generateQRCodeSVG(data: string, options: QRCodeOptions = {}): string {\n  const {\n    size = 256,\n    margin = 4,\n    darkColor = '#000000',\n    lightColor = '#ffffff',\n  } = options;\n\n  const matrix = generateQRMatrix(data);\n  const moduleCount = matrix.length;\n  const moduleSize = size / (moduleCount + margin * 2);\n\n  let svg = `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 ${size} ${size}\" width=\"${size}\" height=\"${size}\">`;\n  svg += `<rect width=\"${size}\" height=\"${size}\" fill=\"${lightColor}\"/>`;\n\n  for (let row = 0; row < moduleCount; row++) {\n    for (let col = 0; col < moduleCount; col++) {\n      if (matrix[row][col]) {\n        const x = (col + margin) * moduleSize;\n        const y = (row + margin) * moduleSize;\n        svg += `<rect x=\"${x}\" y=\"${y}\" width=\"${moduleSize}\" height=\"${moduleSize}\" fill=\"${darkColor}\"/>`;\n      }\n    }\n  }\n\n  svg += '</svg>';\n  return svg;\n}\n\n/**\n * Generate QR code as data URL (base64 PNG simulation via SVG)\n */\nexport function generateQRCodeDataURL(data: string, options: QRCodeOptions = {}): string {\n  const svg = generateQRCodeSVG(data, options);\n  const base64 = Buffer.from(svg).toString('base64');\n  return `data:image/svg+xml;base64,${base64}`;\n}\n\n/**\n * Generate complete payment QR code\n */\nexport function generatePaymentQR(\n  data: PaymentQRData,\n  options: QRCodeOptions = {}\n): { uri: string; svg: string; dataUrl: string } {\n  const uri = generatePaymentURI(data);\n  const svg = generateQRCodeSVG(uri, options);\n  const dataUrl = generateQRCodeDataURL(uri, options);\n\n  return { uri, svg, dataUrl };\n}\n\n// ============================================\n// QR Matrix Generation (Simplified Version 2)\n// ============================================\n\nfunction generateQRMatrix(data: string): boolean[][] {\n  const bytes = Buffer.from(data, 'utf8');\n  const version = getMinVersion(bytes.length);\n  const size = version * 4 + 17;\n\n  // Initialize matrix\n  const matrix: boolean[][] = Array(size)\n    .fill(null)\n    .map(() => Array(size).fill(false));\n\n  const reserved: boolean[][] = Array(size)\n    .fill(null)\n    .map(() => Array(size).fill(false));\n\n  // Add finder patterns\n  addFinderPattern(matrix, reserved, 0, 0);\n  addFinderPattern(matrix, reserved, size - 7, 0);\n  addFinderPattern(matrix, reserved, 0, size - 7);\n\n  // Add timing patterns\n  addTimingPatterns(matrix, reserved, size);\n\n  // Add alignment patterns (for version 2+)\n  if (version >= 2) {\n    addAlignmentPatterns(matrix, reserved, version, size);\n  }\n\n  // Reserve format info areas\n  reserveFormatAreas(reserved, size);\n\n  // Encode data\n  const encoded = encodeData(bytes, version);\n\n  // Place data in matrix\n  placeData(matrix, reserved, encoded, size);\n\n  // Apply mask (using mask 0 for simplicity)\n  applyMask(matrix, reserved, size, 0);\n\n  // Add format info\n  addFormatInfo(matrix, size, 0);\n\n  return matrix;\n}\n\nfunction getMinVersion(dataLength: number): number {\n  // Simplified version selection for byte mode with M error correction\n  const capacities = [0, 14, 26, 42, 62, 84, 106, 122, 152, 180, 213];\n  for (let v = 1; v <= 10; v++) {\n    if (dataLength <= capacities[v]) return v;\n  }\n  return 10; // Max version we support\n}\n\nfunction addFinderPattern(\n  matrix: boolean[][],\n  reserved: boolean[][],\n  row: number,\n  col: number\n): void {\n  for (let r = -1; r <= 7; r++) {\n    for (let c = -1; c <= 7; c++) {\n      const rr = row + r;\n      const cc = col + c;\n      if (rr < 0 || cc < 0 || rr >= matrix.length || cc >= matrix.length) continue;\n\n      reserved[rr][cc] = true;\n\n      if (r === -1 || r === 7 || c === -1 || c === 7) {\n        matrix[rr][cc] = false;\n      } else if (r === 0 || r === 6 || c === 0 || c === 6) {\n        matrix[rr][cc] = true;\n      } else if (r >= 2 && r <= 4 && c >= 2 && c <= 4) {\n        matrix[rr][cc] = true;\n      } else {\n        matrix[rr][cc] = false;\n      }\n    }\n  }\n}\n\nfunction addTimingPatterns(matrix: boolean[][], reserved: boolean[][], size: number): void {\n  for (let i = 8; i < size - 8; i++) {\n    const bit = i % 2 === 0;\n    matrix[6][i] = bit;\n    matrix[i][6] = bit;\n    reserved[6][i] = true;\n    reserved[i][6] = true;\n  }\n}\n\nfunction addAlignmentPatterns(\n  matrix: boolean[][],\n  reserved: boolean[][],\n  version: number,\n  size: number\n): void {\n  const positions = getAlignmentPositions(version);\n\n  for (const row of positions) {\n    for (const col of positions) {\n      // Skip if overlapping with finder patterns\n      if (\n        (row < 9 && col < 9) ||\n        (row < 9 && col > size - 10) ||\n        (row > size - 10 && col < 9)\n      ) {\n        continue;\n      }\n\n      for (let r = -2; r <= 2; r++) {\n        for (let c = -2; c <= 2; c++) {\n          const rr = row + r;\n          const cc = col + c;\n          reserved[rr][cc] = true;\n\n          if (r === -2 || r === 2 || c === -2 || c === 2) {\n            matrix[rr][cc] = true;\n          } else if (r === 0 && c === 0) {\n            matrix[rr][cc] = true;\n          } else {\n            matrix[rr][cc] = false;\n          }\n        }\n      }\n    }\n  }\n}\n\nfunction getAlignmentPositions(version: number): number[] {\n  if (version === 1) return [];\n  const positions = [6];\n  const step = Math.floor((version * 4 + 10) / (Math.floor(version / 7) + 1));\n  let pos = version * 4 + 10;\n  while (pos > 6 + step) {\n    positions.unshift(pos);\n    pos -= step;\n  }\n  positions.unshift(6);\n  return [...new Set(positions)].sort((a, b) => a - b);\n}\n\nfunction reserveFormatAreas(reserved: boolean[][], size: number): void {\n  // Around top-left finder\n  for (let i = 0; i < 9; i++) {\n    reserved[8][i] = true;\n    reserved[i][8] = true;\n  }\n  // Around top-right finder\n  for (let i = 0; i < 8; i++) {\n    reserved[8][size - 1 - i] = true;\n  }\n  // Around bottom-left finder\n  for (let i = 0; i < 8; i++) {\n    reserved[size - 1 - i][8] = true;\n  }\n  // Dark module\n  reserved[size - 8][8] = true;\n}\n\nfunction encodeData(data: Buffer, version: number): boolean[] {\n  const bits: boolean[] = [];\n\n  // Mode indicator (byte mode = 0100)\n  pushBits(bits, MODE_BYTE, 4);\n\n  // Character count (8 bits for version 1-9, 16 for 10+)\n  const countBits = version < 10 ? 8 : 16;\n  pushBits(bits, data.length, countBits);\n\n  // Data\n  for (const byte of data) {\n    pushBits(bits, byte, 8);\n  }\n\n  // Terminator\n  const capacity = getDataCapacity(version);\n  const remaining = capacity - bits.length;\n  if (remaining > 0) {\n    pushBits(bits, 0, Math.min(4, remaining));\n  }\n\n  // Pad to byte boundary\n  while (bits.length % 8 !== 0) {\n    bits.push(false);\n  }\n\n  // Pad codewords\n  const padBytes = [0xec, 0x11];\n  let padIndex = 0;\n  while (bits.length < capacity) {\n    pushBits(bits, padBytes[padIndex % 2], 8);\n    padIndex++;\n  }\n\n  // Add error correction\n  return addErrorCorrection(bits, version);\n}\n\nfunction getDataCapacity(version: number): number {\n  // Data capacity in bits for M error correction level\n  const capacities = [0, 128, 224, 352, 512, 688, 864, 992, 1232, 1456, 1728];\n  return capacities[version] || 1728;\n}\n\nfunction pushBits(arr: boolean[], value: number, count: number): void {\n  for (let i = count - 1; i >= 0; i--) {\n    arr.push(((value >> i) & 1) === 1);\n  }\n}\n\nfunction addErrorCorrection(data: boolean[], version: number): boolean[] {\n  // Simplified: For versions 1-10 with M level, add basic EC\n  // In production, use proper Reed-Solomon encoding\n\n  const dataBytes: number[] = [];\n  for (let i = 0; i < data.length; i += 8) {\n    let byte = 0;\n    for (let j = 0; j < 8 && i + j < data.length; j++) {\n      if (data[i + j]) byte |= 1 << (7 - j);\n    }\n    dataBytes.push(byte);\n  }\n\n  // Generate EC codewords (simplified polynomial division)\n  const ecCount = getECCount(version);\n  const ecBytes = generateECBytes(dataBytes, ecCount);\n\n  // Combine data and EC\n  const result: boolean[] = [...data];\n  for (const byte of ecBytes) {\n    pushBits(result, byte, 8);\n  }\n\n  return result;\n}\n\nfunction getECCount(version: number): number {\n  // EC codewords for M level\n  const counts = [0, 10, 16, 26, 18, 24, 16, 18, 22, 22, 26];\n  return counts[version] || 26;\n}\n\nfunction generateECBytes(data: number[], ecCount: number): number[] {\n  // Simplified Reed-Solomon using GF(256)\n  const gfExp = new Uint8Array(512);\n  const gfLog = new Uint8Array(256);\n\n  // Generate GF tables\n  let x = 1;\n  for (let i = 0; i < 255; i++) {\n    gfExp[i] = x;\n    gfLog[x] = i;\n    x <<= 1;\n    if (x & 0x100) x ^= 0x11d;\n  }\n  for (let i = 255; i < 512; i++) {\n    gfExp[i] = gfExp[i - 255];\n  }\n\n  // Generate generator polynomial\n  const gen: number[] = [1];\n  for (let i = 0; i < ecCount; i++) {\n    const newGen: number[] = new Array(gen.length + 1).fill(0);\n    for (let j = 0; j < gen.length; j++) {\n      newGen[j] ^= gen[j];\n      newGen[j + 1] ^= gfExp[(gfLog[gen[j]] + i) % 255];\n    }\n    gen.length = 0;\n    gen.push(...newGen);\n  }\n\n  // Perform polynomial division\n  const msg = [...data, ...new Array(ecCount).fill(0)];\n  for (let i = 0; i < data.length; i++) {\n    const coef = msg[i];\n    if (coef !== 0) {\n      for (let j = 1; j < gen.length; j++) {\n        if (gen[j] !== 0) {\n          msg[i + j] ^= gfExp[(gfLog[gen[j]] + gfLog[coef]) % 255];\n        }\n      }\n    }\n  }\n\n  return msg.slice(data.length);\n}\n\nfunction placeData(\n  matrix: boolean[][],\n  reserved: boolean[][],\n  data: boolean[],\n  size: number\n): void {\n  let dataIndex = 0;\n  let upward = true;\n\n  for (let col = size - 1; col > 0; col -= 2) {\n    if (col === 6) col = 5; // Skip timing pattern column\n\n    for (let i = 0; i < size; i++) {\n      const row = upward ? size - 1 - i : i;\n\n      for (const c of [col, col - 1]) {\n        if (!reserved[row][c] && dataIndex < data.length) {\n          matrix[row][c] = data[dataIndex++];\n        }\n      }\n    }\n\n    upward = !upward;\n  }\n}\n\nfunction applyMask(\n  matrix: boolean[][],\n  reserved: boolean[][],\n  size: number,\n  mask: number\n): void {\n  for (let row = 0; row < size; row++) {\n    for (let col = 0; col < size; col++) {\n      if (!reserved[row][col] && shouldMask(row, col, mask)) {\n        matrix[row][col] = !matrix[row][col];\n      }\n    }\n  }\n}\n\nfunction shouldMask(row: number, col: number, mask: number): boolean {\n  switch (mask) {\n    case 0:\n      return (row + col) % 2 === 0;\n    case 1:\n      return row % 2 === 0;\n    case 2:\n      return col % 3 === 0;\n    case 3:\n      return (row + col) % 3 === 0;\n    case 4:\n      return (Math.floor(row / 2) + Math.floor(col / 3)) % 2 === 0;\n    case 5:\n      return ((row * col) % 2) + ((row * col) % 3) === 0;\n    case 6:\n      return (((row * col) % 2) + ((row * col) % 3)) % 2 === 0;\n    case 7:\n      return (((row + col) % 2) + ((row * col) % 3)) % 2 === 0;\n    default:\n      return false;\n  }\n}\n\nfunction addFormatInfo(matrix: boolean[][], size: number, mask: number): void {\n  // Format info for EC level M (01) and mask\n  const formatBits = getFormatBits(EC_LEVEL, mask);\n\n  // Place format info\n  for (let i = 0; i < 15; i++) {\n    const bit = formatBits[i];\n\n    // Around top-left\n    if (i < 6) {\n      matrix[i][8] = bit;\n    } else if (i < 8) {\n      matrix[i + 1][8] = bit;\n    } else {\n      matrix[8][14 - i] = bit;\n    }\n\n    // Around top-right and bottom-left\n    if (i < 8) {\n      matrix[8][size - 1 - i] = bit;\n    } else {\n      matrix[size - 15 + i][8] = bit;\n    }\n  }\n\n  // Dark module\n  matrix[size - 8][8] = true;\n}\n\nfunction getFormatBits(ecLevel: number, mask: number): boolean[] {\n  // Pre-computed format strings for M level (01) and masks 0-7\n  const formats: { [key: string]: string } = {\n    '1-0': '101010000010010',\n    '1-1': '101000100100101',\n    '1-2': '101111001111100',\n    '1-3': '101101101001011',\n    '1-4': '100010111111001',\n    '1-5': '100000011001110',\n    '1-6': '100111110010111',\n    '1-7': '100101010100000',\n  };\n\n  const key = `${ecLevel}-${mask}`;\n  const format = formats[key] || formats['1-0'];\n\n  return format.split('').map(c => c === '1');\n}\n","/**\n * PAYLINK Token Integration\n * Native token support for Paylink Protocol\n * \n * Token: PAYLINK\n * Mint: cMNjNj2NMaEniE37KvyV2GCyQJnbY8YDeANBhSMpump\n * Chain: Solana\n * Decimals: 6 (standard pump.fun token)\n */\n\nimport type { PaymentCheckResult } from './types.js';\n\n/**\n * PAYLINK Token Constants\n */\nexport const PAYLINK_TOKEN = {\n  /** Token mint address */\n  MINT: 'cMNjNj2NMaEniE37KvyV2GCyQJnbY8YDeANBhSMpump',\n  /** Token symbol */\n  SYMBOL: 'PAYLINK',\n  /** Token decimals (pump.fun standard) */\n  DECIMALS: 6,\n  /** Chain ID (Solana mainnet) */\n  CHAIN_ID: 101,\n} as const;\n\n/**\n * Discount tiers based on PAYLINK holdings\n */\nexport interface DiscountTier {\n  /** Minimum token balance required */\n  minBalance: number;\n  /** Discount percentage (0-100) */\n  discountPercent: number;\n  /** Tier name */\n  name: string;\n}\n\n/**\n * Default discount tiers\n */\nexport const DEFAULT_DISCOUNT_TIERS: DiscountTier[] = [\n  { minBalance: 1_000_000, discountPercent: 50, name: 'Diamond' },    // 1M tokens = 50% off\n  { minBalance: 500_000, discountPercent: 30, name: 'Platinum' },     // 500K tokens = 30% off\n  { minBalance: 100_000, discountPercent: 20, name: 'Gold' },         // 100K tokens = 20% off\n  { minBalance: 10_000, discountPercent: 10, name: 'Silver' },        // 10K tokens = 10% off\n  { minBalance: 1_000, discountPercent: 5, name: 'Bronze' },          // 1K tokens = 5% off\n];\n\n/**\n * PAYLINK configuration\n */\nexport interface PaylinkTokenConfig {\n  /** Solana RPC URL */\n  rpcUrl: string;\n  /** Enable PAYLINK token payments */\n  enableTokenPayments?: boolean;\n  /** Discount when paying with PAYLINK (percentage, 0-100) */\n  tokenPaymentDiscount?: number;\n  /** Enable holder discounts */\n  enableHolderDiscounts?: boolean;\n  /** Custom discount tiers (optional) */\n  discountTiers?: DiscountTier[];\n  /** Request timeout in ms */\n  timeout?: number;\n}\n\ninterface TokenAccountInfo {\n  mint: string;\n  owner: string;\n  amount: string;\n  decimals: number;\n}\n\ninterface JsonRpcResponse<T> {\n  jsonrpc: string;\n  id: number;\n  result?: T;\n  error?: { code: number; message: string };\n}\n\n/**\n * PAYLINK Token Manager\n * Handles token balance checks, discounts, and SPL token payment verification\n */\nexport class PaylinkTokenManager {\n  private config: Required<PaylinkTokenConfig>;\n  private requestId = 0;\n\n  constructor(config: PaylinkTokenConfig) {\n    this.config = {\n      rpcUrl: config.rpcUrl,\n      enableTokenPayments: config.enableTokenPayments ?? true,\n      tokenPaymentDiscount: config.tokenPaymentDiscount ?? 10,\n      enableHolderDiscounts: config.enableHolderDiscounts ?? true,\n      discountTiers: config.discountTiers ?? DEFAULT_DISCOUNT_TIERS,\n      timeout: config.timeout ?? 30000,\n    };\n  }\n\n  /**\n   * Get PAYLINK token balance for a wallet\n   */\n  async getTokenBalance(walletAddress: string): Promise<number> {\n    try {\n      const tokenAccounts = await this.getTokenAccountsByOwner(walletAddress);\n      \n      const paylinkAccount = tokenAccounts.find(\n        acc => acc.mint === PAYLINK_TOKEN.MINT\n      );\n\n      if (!paylinkAccount) {\n        return 0;\n      }\n\n      // Convert from raw amount to token amount\n      return Number(paylinkAccount.amount) / Math.pow(10, PAYLINK_TOKEN.DECIMALS);\n    } catch (error) {\n      console.error('Error fetching PAYLINK balance:', error);\n      return 0;\n    }\n  }\n\n  /**\n   * Get discount tier for a wallet based on PAYLINK holdings\n   */\n  async getDiscountTier(walletAddress: string): Promise<DiscountTier | null> {\n    if (!this.config.enableHolderDiscounts) {\n      return null;\n    }\n\n    const balance = await this.getTokenBalance(walletAddress);\n    \n    // Sort tiers by minBalance descending to find highest qualifying tier\n    const sortedTiers = [...this.config.discountTiers].sort(\n      (a, b) => b.minBalance - a.minBalance\n    );\n\n    for (const tier of sortedTiers) {\n      if (balance >= tier.minBalance) {\n        return tier;\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Calculate discounted price based on holder tier\n   */\n  async calculateDiscountedPrice(\n    walletAddress: string,\n    originalPrice: number\n  ): Promise<{ price: number; discount: number; tier: DiscountTier | null }> {\n    const tier = await this.getDiscountTier(walletAddress);\n    \n    if (!tier) {\n      return { price: originalPrice, discount: 0, tier: null };\n    }\n\n    const discount = (originalPrice * tier.discountPercent) / 100;\n    const price = originalPrice - discount;\n\n    return { price, discount, tier };\n  }\n\n  /**\n   * Get price when paying with PAYLINK token\n   */\n  getTokenPaymentPrice(originalPrice: number): number {\n    if (!this.config.enableTokenPayments) {\n      return originalPrice;\n    }\n\n    const discount = (originalPrice * this.config.tokenPaymentDiscount) / 100;\n    return originalPrice - discount;\n  }\n\n  /**\n   * Verify PAYLINK token payment\n   */\n  async verifyTokenPayment(params: {\n    txHash: string;\n    recipient: string;\n    amount: string;\n  }): Promise<PaymentCheckResult> {\n    try {\n      const tx = await this.getTransaction(params.txHash);\n\n      if (!tx) {\n        return { status: 'not_found' };\n      }\n\n      if (tx.meta?.err) {\n        return { status: 'failed' };\n      }\n\n      // Parse SPL token transfer\n      const transfer = this.parseTokenTransfer(tx, params.recipient);\n\n      if (!transfer) {\n        return { status: 'not_found' };\n      }\n\n      // Verify it's PAYLINK token\n      if (transfer.mint !== PAYLINK_TOKEN.MINT) {\n        return { status: 'not_found' };\n      }\n\n      // Convert amount to token units\n      const actualAmount = transfer.amount / Math.pow(10, PAYLINK_TOKEN.DECIMALS);\n      const requiredAmount = parseFloat(params.amount);\n\n      if (actualAmount < requiredAmount) {\n        return {\n          status: 'underpaid',\n          actualAmount: actualAmount.toString(),\n          fromAddress: transfer.from,\n        };\n      }\n\n      return {\n        status: 'confirmed',\n        actualAmount: actualAmount.toString(),\n        fromAddress: transfer.from,\n        raw: tx,\n      };\n    } catch (error) {\n      console.error('PAYLINK payment verification error:', error);\n      return { status: 'not_found' };\n    }\n  }\n\n  /**\n   * Parse SPL token transfer from transaction\n   */\n  private parseTokenTransfer(\n    tx: any,\n    expectedRecipient: string\n  ): { mint: string; from: string; to: string; amount: number } | null {\n    try {\n      // Look for token balance changes in postTokenBalances\n      const preBalances = tx.meta?.preTokenBalances || [];\n      const postBalances = tx.meta?.postTokenBalances || [];\n\n      // Find PAYLINK transfers to recipient\n      for (const post of postBalances) {\n        if (post.mint !== PAYLINK_TOKEN.MINT) continue;\n\n        const pre = preBalances.find(\n          (p: any) => p.accountIndex === post.accountIndex\n        );\n\n        const preAmount = pre ? Number(pre.uiTokenAmount?.amount || 0) : 0;\n        const postAmount = Number(post.uiTokenAmount?.amount || 0);\n        const diff = postAmount - preAmount;\n\n        if (diff > 0) {\n          // This account received tokens\n          const owner = post.owner;\n          \n          if (owner?.toLowerCase() === expectedRecipient.toLowerCase()) {\n            // Find sender (account with negative diff)\n            let sender = '';\n            for (const otherPost of postBalances) {\n              if (otherPost.mint !== PAYLINK_TOKEN.MINT) continue;\n              const otherPre = preBalances.find(\n                (p: any) => p.accountIndex === otherPost.accountIndex\n              );\n              const otherPreAmount = otherPre ? Number(otherPre.uiTokenAmount?.amount || 0) : 0;\n              const otherPostAmount = Number(otherPost.uiTokenAmount?.amount || 0);\n              if (otherPostAmount - otherPreAmount < 0) {\n                sender = otherPost.owner || '';\n                break;\n              }\n            }\n\n            return {\n              mint: PAYLINK_TOKEN.MINT,\n              from: sender,\n              to: owner,\n              amount: diff,\n            };\n          }\n        }\n      }\n\n      return null;\n    } catch {\n      return null;\n    }\n  }\n\n  /**\n   * Get token accounts for a wallet\n   */\n  private async getTokenAccountsByOwner(owner: string): Promise<TokenAccountInfo[]> {\n    const result = await this.rpc<{\n      value: Array<{\n        account: {\n          data: {\n            parsed: {\n              info: TokenAccountInfo;\n            };\n          };\n        };\n      }>;\n    }>('getTokenAccountsByOwner', [\n      owner,\n      { programId: 'TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA' },\n      { encoding: 'jsonParsed' },\n    ]);\n\n    if (!result?.value) {\n      return [];\n    }\n\n    return result.value.map(item => item.account.data.parsed.info);\n  }\n\n  /**\n   * Get transaction details\n   */\n  private async getTransaction(signature: string): Promise<any> {\n    return this.rpc('getTransaction', [\n      signature,\n      {\n        encoding: 'jsonParsed',\n        commitment: 'confirmed',\n        maxSupportedTransactionVersion: 0,\n      },\n    ]);\n  }\n\n  /**\n   * Make RPC call\n   */\n  private async rpc<T>(method: string, params: unknown[]): Promise<T | null> {\n    const controller = new AbortController();\n    const timeout = setTimeout(() => controller.abort(), this.config.timeout);\n\n    try {\n      const response = await fetch(this.config.rpcUrl, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          jsonrpc: '2.0',\n          id: ++this.requestId,\n          method,\n          params,\n        }),\n        signal: controller.signal,\n      });\n\n      const data = (await response.json()) as JsonRpcResponse<T>;\n\n      if (data.error) {\n        console.error('RPC error:', data.error);\n        return null;\n      }\n\n      return data.result ?? null;\n    } catch (error) {\n      console.error('RPC request failed:', error);\n      return null;\n    } finally {\n      clearTimeout(timeout);\n    }\n  }\n}\n\n/**\n * Create a PAYLINK token manager\n */\nexport function createPaylinkTokenManager(config: PaylinkTokenConfig): PaylinkTokenManager {\n  return new PaylinkTokenManager(config);\n}\n\n/**\n * Check if a token symbol is PAYLINK\n */\nexport function isPaylinkToken(symbol: string): boolean {\n  return symbol.toUpperCase() === PAYLINK_TOKEN.SYMBOL;\n}\n\n/**\n * Format PAYLINK amount for display\n */\nexport function formatPaylinkAmount(amount: number): string {\n  if (amount >= 1_000_000) {\n    return `${(amount / 1_000_000).toFixed(2)}M`;\n  }\n  if (amount >= 1_000) {\n    return `${(amount / 1_000).toFixed(2)}K`;\n  }\n  return amount.toFixed(2);\n}\n"],"mappings":"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","names":["ReasonCode","import_crypto","express","helmet","cors"]}